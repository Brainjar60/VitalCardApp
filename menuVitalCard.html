<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="author" content="www.frebsite.nl" />
		<meta name="viewport" content="width=device-width initial-scale=1.0 maximum-scale=1.0 user-scalable=yes" />

		<title>VitalCard App</title>

		<link type="text/css" rel="stylesheet" href="css/menuDemo.css?v=" />
		<link type="text/css" rel="stylesheet" href="css/jquery.mmenu.all.css?v=" />
		<link type="text/css" rel="stylesheet" href="css/font-awesome.min.css" />
		<link rel="stylesheet" href="css/jquery-ui.css" />
		<style type="text/css">
			.content {
				padding-top: 0;
				background-position: 35px 55px;
			}
			#intro,
			#first,
			#second,
			#fourth,
			#fifth,
			#third {
				height: 350px;
				padding-top: 190px;
			}
			#first,
			#second,
			#fourth,
			#fifth,
			#third {
				border-top: 1px solid #ccc;
			}
			.mm-menu {
				box-shadow: 0 0 40px rgba( 0, 0, 0, 0.2 );
			}
			.menuItemPage {
                background-color: #FFDFDD;
                color: Blue;
            }
			.menuItemTitle {
                background-color: #E0B0FF;
                color: #E42217;
            }
			TD {
                font-size: 8pt;
            }
		</style>

		<script type="text/javascript" src="js/jquery-1.8.3.js"></script>
		<script type="text/javascript" src="js/jquery.mmenu.all.min.js?v="></script>
        <script type="text/javascript" src="js/jquery.imageCaching.js"></script>

        <!--script src="js/jquery-1.8.3.js"></script-->
        <script src="js/jquery-ui.js"></script>
        <script src="js/ui.datepicker-it.js"></script>
  		<script type="text/javascript">
			$(function() {
				
				$("#dataDal").datepicker();
				$("#dataAl").datepicker();
				
				var $menu = $('nav#menu'),
					$html = $('html, body');

				$menu.mmenu({
					extensions 	: [ "pageshadow" ],
					offCanvas	: {
						position 	: "bottom",
						zposition	: "front"
					},
					navbar 		: {
						title 		: "VitalCard Menu"
					}
				});
                var codPaziente = window.localStorage.getItem('codPaziente'); 
                var imgPaziente = window.localStorage.getItem("imgPaziente");
                var datPaziente = window.localStorage.getItem("datiPersonali");
                var datMalattie = window.localStorage.getItem("datiMalattie");
                var datPatologie = window.localStorage.getItem("datiPatologie");
                var datAllergie = window.localStorage.getItem("datiAllergie");
                var datTrattamenti = window.localStorage.getItem("datiTrattamenti");
                if (codPaziente) {
                     var codicePaziente = document.getElementById("codPaziente");
                     codicePaziente.value = codPaziente;
                }
				if (imgPaziente) {
					getImagePaziente();
				}
				if (datPaziente) {
				    var dp = document.getElementById("divDatiPersonali");
                    dp.innerHTML = datPaziente;
				}
				if (datMalattie) {
				   	var dm = document.getElementById("divDatiMalattie");
                	dm.innerHTML = datMalattie;
				}
				var API = $menu.data( "mmenu" );
				API.setSelected( $menu.find( "li" ).first() );

				var closer = null;

				$menu.find( 'a' ).on( 'click', function() {
					closer = $(this).attr( "href" );
				});

				API.bind( "closed", function() {
					if ( closer ) {
						setTimeout( function() {
							$html.animate({
								scrollTop: $(closer).offset().top
							});	
							closer = null;
						}, 25 );
					}	
				});
            });
			//var blProvaHost = true; 
            var host = "localhost:1464";
			//var host = "10.0.0.3:80"; 			
            //var host = "www.atvinformatica.it"; 

            function goToCF() {

                var cognome = document.getElementById("txtCognome").value;
                var nome = document.getElementById("txtNome").value;
                var sesso = document.getElementById("txtSesso").value;
                var data = document.getElementById("txtData").value;
                var luogo = document.getElementById("txtLuogo").value;
                var provincia = document.getElementById("txtProvincia").value;
                // callCreaCF(cognome, nome, sesso, data, luogo, provincia
                //ajaxCallCF(cognome, nome, sesso, data, luogo, provincia);
                callHandler(); 
            }

            function ajaxCallCF(cognome, nome, sesso, data, luogo, provincia) {
                //alert(cognome + ' ' + nome + ' ' + sesso + ' ' + data + ' ' + luogo + ' ' + provincia);
                $.ajax({
                    crossDomain: true,
                    contentType: "application/json; charset=utf-8",
                    url: "http://" + host + "/CF.aspx/creaCF",
                    data: "{ cognome: '" + cognome + "', nome: '" + nome + "', sesso: '" + sesso + "', data: '" + data + "', luogo: '" + luogo + "', provincia: '" + provincia + "'}",
                    dataType: "json",
                    success: showCF,
                }).done(
                    // nothing 
                );

            }
            function showCF(res) {
                //alert(res); 
                var cf = document.getElementById("txtCF");
                cf.value = res.d;
            }
            function jsonp_callback(res) {
                //alert(res);
                var cf = document.getElementById("txtCF");
                cf.value = res;
            }
            function jsonp_callbackCP(res) {
                //alert(res);
                var dati = res.split("||");
                var dp = document.getElementById("divDatiPersonali");
                dp.innerHTML = dati[0];
				localStorage.setItem("datiPersonali", dati[0]);
                
				var dm = document.getElementById("divDatiMalattie");
                dm.innerHTML = dati[1];
				localStorage.setItem("datiMalattie", dati[1]);
				
                var dp = document.getElementById("divDatiPatologie");
                dp.innerHTML = dati[2];
				localStorage.setItem("datiPatologie", dati[2]);
				
                var da = document.getElementById("divDatiAllergie");
                da.innerHTML = dati[3];
				localStorage.setItem("datiAllergie", dati[3]);
				
                var dt = document.getElementById("divDatiTrattamenti");
                dt.innerHTML = dati[4];
				localStorage.setItem("datiTrattamenti", dati[4]);
                
				var df = document.getElementById("imgDatiPaziente");
                df.src = "data:image/jpg;base64," + dati[5]; 
				localStorage.setItem("imgPaziente", dati[5]);
				writeTable();
            }
            function getImagePaziente() {
                var dataImage = localStorage.getItem('imgPaziente');
                var bannerImg = document.getElementById('imgDatiPaziente');
                bannerImg.src = "data:image/jpg;base64," + dataImage;
            }
            function saveImage(dfSrc) {
                localStorage.setItem("imgPaziente", imgData);
			}
            function getBase64Image(img) {
                var canvas = document.createElement("canvas");
                canvas.width = img.width;
                canvas.height = img.height;

                var ctx = canvas.getContext("2d");
                ctx.drawImage(img, 0, 0);

                var dataURL = canvas.toDataURL("image/jpg");

                return dataURL.replace(/^data:image\/(png|jpg);base64,/, "");
            }

            function getDatiPaziente() {
                var codicePaziente = document.getElementById("codPaziente").value;
                window.localStorage.setItem('codPaziente', codicePaziente); 
                $.ajax({
                    dataType: 'jsonp',
                    jsonpCallback: 'jsonp_callbackCP',
                    url: 'http://' + host + '/TestServicePaziente.ashx?callback=?&codicePaziente='+ codicePaziente,
                });
            }
            function callHandler() {
                var cognome = document.getElementById("txtCognome").value;
                var nome = document.getElementById("txtNome").value;
                var sesso = document.getElementById("txtSesso").value;
                var data = document.getElementById("txtData").value;
                var luogo = document.getElementById("txtLuogo").value;
                var provincia = document.getElementById("txtProvincia").value;
                $.ajax({
                    dataType: 'jsonp',
                    jsonpCallback: 'jsonp_callback',
                    url: 'http://' + host + '/TestService.ashx?callback=?&cognome='+ cognome + '&nome=' + nome + '&sesso=' + sesso + '&data=' + data + '&luogo='+ luogo + '&provincia='+ provincia,
                });
            }
			var icont = 0;
			function clickRef(actn, cntx)
	        {
			    icont = cntx;
				var contesto = ""; 
				if (cntx == 1) contesto = "Malattie"; 
				if (cntx == 2) contesto = "Patologie"; 
				if (cntx == 3) contesto = "Allergie"; 
				if (cntx == 4) contesto = "Trattamenti non accettati"; 
			    switch (actn) {
					   case  1:
					       if (cntx == 1) { 
								document.getElementById("divDatiMalattie").style.display = "none"; 
								document.getElementById("azioni_malattie").style.display = "none"; 
								document.getElementById("divEditaMalattia").innerHTML = editaElemento("") ; 
								$("#dataDal").datepicker({changeMonth: true, changeYear: true, maxDate: '+1Y', minDate: '-100Y', yearRange: '-100:+1'});
								$("#dataAl").datepicker({changeMonth: true, changeYear: true, maxDate: '+1Y', minDate: '-100Y', yearRange: '-100:+1'});
								document.getElementById("divEditaMalattia").style.display = "block"; 

						   }
						   break;
					   case  2:
					       alert("Clicked on delete button for " + contesto); 
						   break;	
					   case  3:
					       alert("Clicked on edit button for " + contesto); 
						   break;
					   default:
						   break;					   						   				   
				}		 
			}
			// -------------------------------------------
			var array = [1,2,3,4,5,6,7,8,1,2,3,4,5,6,7,8];
			var count = 0;
			var totalCells = 4;
			// -------------------------------------------
			function writeTable() {
				// cache <tbody> element:
				var tbody = $('#bodyM');
				for (var i = 0; i < array.length / 8; i++) {
					// create an <tr> element, append it to the <tbody> and cache it as a variable:
					var tr = $('<tr/>').appendTo(tbody);
					for (var j = 0; j < totalCells; j++) {
						// append <td> elements to previously created <tr> element:
						tr.append('<td>' + array[count] + '</td>');
						count++;
					}
				}
				// reset the count:
				count = 0;
				
				tbody = $('#bodyP');
				for (var i = 0; i < array.length / 8; i++) {
					// create an <tr> element, append it to the <tbody> and cache it as a variable:
					var tr = $('<tr/>').appendTo(tbody);
					for (var j = 0; j < totalCells; j++) {
						// append <td> elements to previously created <tr> element:
						tr.append('<td>' + array[count] + '</td>');
						count++;
					}
				}
				// reset the count:
				count = 0;
				tbody = $('#bodyA');
				for (var i = 0; i < array.length / 8; i++) {
					// create an <tr> element, append it to the <tbody> and cache it as a variable:
					var tr = $('<tr/>').appendTo(tbody);
					for (var j = 0; j < totalCells; j++) {
						// append <td> elements to previously created <tr> element:
						tr.append('<td>' + array[count] + '</td>');
						count++;
					}
				}
				// reset the count:
				count = 0;
				tbody = $('#bodyT');
				for (var i = 0; i < array.length / 8; i++) {
					// create an <tr> element, append it to the <tbody> and cache it as a variable:
					var tr = $('<tr/>').appendTo(tbody);
					for (var j = 0; j < totalCells; j++) {
						// append <td> elements to previously created <tr> element:
						tr.append('<td>' + array[count] + '</td>');
						count++;
					}
				}
				// reset the count:
				count = 0;

			}	
			function editaElemento(elemento) 
			{
				var elemento_body = "<table width='300'><tr><td>Dal</td><td><input type='text' id='dataDal'/></td></tr><tr><td>Al</td><td ><input type='text' id='dataAl'/></td></tr><tr><td>Tipo</td><td id='tipo'><input type='text' /></td></tr><tr><td>Descr.</td><td id='descr'><input type='text' /></td></tr><tr><td></td><td><input type='button' value='Accetta' onclick='setDati();'/>&nbsp;&nbsp;&nbsp;<input type='button' value='Annulla' onclick='setDati();'/></td></tr></table>";
				return elemento_body;
			}	
			function setDati() {
				switch (icont) {
				 case 1: { 
				      document.getElementById("divDatiMalattie").style.display = "block"; 
					  document.getElementById("azioni_malattie").style.display = "block"; 
					  //document.getElementById("divEditaMalattia").innerHTML = editaElemento("") ; 
					  document.getElementById("divEditaMalattia").style.display = "none"; 
				 	  break;
				 }
				}
			}
		</script>
	</head>
	<body>
		<div id="page">
			<div class="header Fixed">
				<a href="#menu"></a>
	            VitalCARD Android 
		    </div>
			<div class="content menuItemPage">
				<div id="intro" class="menuItemInfo">					
					<p><strong>Questa è l'app VitalCard.</strong><br />
						Click sull'icona del menu per aprire la lista delle funzionalità.</p>
					
					<p>Ogni voce del menu' rimanda ad una sezione della stessa pagina, con un effetto di scorrimento molto piacevole.</p>
				</div>
				<div id="first" class="menuItemInfo">
					<p><strong>Dati Personali</strong><br /></p>
                        <div id="divFotoPersonale">
                            <table>
                                <tr>
                                    <td><img id="imgDatiPaziente" src=""/></td>
									<td>
										<table>
											<tr>
												<td><H4><font color="Blue">Codice paziente</font></H4></td>
											<tr>
											</tr>
												<td><input type="text" id="codPaziente" value=""/></td>
											</tr>
											<tr>
											  <td><input type="button" value="Ricarica" onclick="getDatiPaziente();"/></td>
											</tr>
										</table>
									</td>
								</tr>
                            </table>
						</div> 
                        <div id="divDatiPersonali"></div>                       
					    <p><a href="#menu">Ritorna al menu.</a></p>
				</div>
				<div id="second" class="menuItemInfo">
					<p><strong>Malattie</strong><br /></p>
                            <div id="divDatiMalattie"></div>
							<div id="azioni_malattie"><table style="border-spacing: 20px;"><tr><td><img id="add" src="img/document_add.png" onclick="clickRef(1, 1);"/></td><td><img id="del" src="img/document_delete.png" onclick="clickRef(2, 1);"/></td><td><img id="edt" src="img/document_edit.png" onclick="clickRef(3, 1);"/></td></tr></table></div>
							<div id="divEditaMalattia" style="display: none;"></div>
							<p><a href="#menu">Ritorna al menu.</a></p>
				</div>
				<div id="third" class="menuItemInfo">
					<p><strong>Patologie in atto</strong><br />
                            <div id="divDatiPatologie">
                            </div>
							<div id="azioni_patologie">
							  <table style="border-spacing: 20px;"><tr><td><img id="add" src="img/document_add.png" onclick="clickRef(1, 2);"/></td><td><img id="del" src="img/document_delete.png" onclick="clickRef(2, 2);"/></td><td><img id="edt" src="img/document_edit.png" onclick="clickRef(3, 2);"/></td></tr></table>
							</div>
					<a href="#menu">Ritorna al menu.</a></p>
				</div>
				<div id="fourth" class="menuItemInfo">
					<p><strong>Allergie</strong><br />
                            <div id="divDatiAllergie">
                            </div>
							<div id="azioni_allergie">
							  <table style="border-spacing: 20px;"><tr><td><img id="add" src="img/document_add.png" onclick="clickRef(1, 3);"/></td><td><img id="del" src="img/document_delete.png" onclick="clickRef(2, 3);"/></td><td><img id="edt" src="img/document_edit.png" onclick="clickRef(3, 3);"/></td></tr></table>
							</div>
					<a href="#menu">Ritorna al menu.</a></p>
				</div>
				<div id="fifth" class="menuItemInfo">
					<p><strong>Trattamenti non accettati</strong><br />
                            <div id="divDatiTrattamenti">
                            </div>
							<div id="azioni_trattamenti">
							  <table style="border-spacing: 20px;"><tr><td><img id="add" src="img/document_add.png" onclick="clickRef(1, 4);"/></td><td><img id="del" src="img/document_delete.png" onclick="clickRef(2, 4);"/></td><td><img id="edt" src="img/document_edit.png" onclick="clickRef(3, 4);"/></td></tr></table>
							</div>
					<a href="#menu">Ritorna al menu.</a></p>
				</div>
  			</div>
		</div>
		<nav id="menu" class="menuItemTitle">
			<ul>
				<li><a href="#intro">Intro</a></li>
				<li><a href="#first">Dati Personali</a></li>
				<li><a href="#second">Malattie</a></li>
				<li><a href="#third">Patologie in atto</a></li>
				<li><a href="#fourth">Allergie</a></li>
				<li><a href="#fifth">Trattamenti non accettati</a></li>
			</ul>
		</nav>
		<div>
			 
		</div>

	</body>
</html>
